sudo: required
dist: trusty
language: php

php:
  - '7.0'

services:
  - postgresql

addons:
   chrome: stable

before_install:
  - psql -c "CREATE USER homestead WITH PASSWORD 'secret';" -U postgres
  - psql -c "CREATE SCHEMA esport_test;" -U postgres
  - psql -c "GRANT ALL ON SCHEMA esport_test TO homestead;" -U postgres

install:
   - cp .env.travis .env
   - composer self-update
   - composer install --no-interaction --ignore-platform-reqs --no-suggest
   - php artisan key:generate
   - php artisan migrate:refresh
   - rm -rf node_modules
   - npm install 
   - npm rebuild node-sass

before_script:
   - google-chrome-stable --headless --disable-gpu --remote-debugging-port=9222 http://localhost &
   - php artisan serve &

script:
   - npm run prod
   - php artisan dusk